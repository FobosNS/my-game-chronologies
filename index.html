<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–•—Ä–æ–Ω–æ–ª–æ–≥–∏–∏ –∏–≥—Ä ‚Äî by FobosNS</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Exo+2:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0b0e1a;
      --bg-secondary: #121826;
      --accent: #00f0ff;
      --accent-hover: #00ccff;
      --text-primary: #e0f8ff;
      --text-secondary: #a0d8e8;
      --card-bg: rgba(20, 30, 50, 0.7);
      --card-border: #2a4a6a;
      --shadow: rgba(0, 240, 255, 0.15);
    }

    body.light-theme {
      --bg-primary: #f0f4f8;
      --bg-secondary: #d9e2ec;
      --accent: #007bff;
      --accent-hover: #0056b3;
      --text-primary: #1a1a1a;
      --text-secondary: #4a4a4a;
      --card-bg: rgba(255, 255, 255, 0.9);
      --card-border: #ccc;
      --shadow: rgba(0, 123, 255, 0.2);
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Exo 2', sans-serif;
      background: linear-gradient(135deg, var(--bg-primary), var(--bg-secondary));
      color: var(--text-primary);
      margin: 0;
      padding: 20px;
      line-height: 1.6;
      transition: background 0.4s ease, padding 0.3s ease;
    }

    h1 {
      text-align: center;
      color: var(--accent);
      font-family: 'Orbitron', monospace;
      font-size: 32px;
      margin: 20px 0 20px;
      text-shadow: 0 0 12px var(--shadow);
      letter-spacing: 1px;
      transition: font-size 0.3s ease;
    }

    .search-box {
      max-width: 600px;
      margin: 0 auto 20px;
      transition: max-width 0.3s ease;
    }

    #searchInput {
      width: 100%;
      padding: 12px 16px;
      font-size: 16px;
      border-radius: 12px;
      border: 1px solid var(--card-border);
      background: var(--card-bg);
      color: var(--text-primary);
      font-family: 'Exo 2', sans-serif;
      transition: padding 0.3s ease, font-size 0.3s ease;
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
      margin-bottom: 20px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      transition: max-width 0.3s ease;
    }

    .control-group {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: center;
    }

    button {
      background: var(--card-bg);
      color: var(--text-primary);
      border: 1px solid var(--card-border);
      padding: 8px 14px;
      font-family: 'Exo 2', sans-serif;
      font-size: 14px;
      cursor: pointer;
      border-radius: 8px;
      transition: all 0.25s ease;
    }

    button:hover {
      background: var(--accent-hover);
      border-color: var(--accent);
      color: var(--text-primary);
    }

    button.active {
      background: var(--accent);
      color: var(--bg-primary);
      font-weight: 600;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      max-width: 1200px;
      margin: 0 auto 20px;
      transition: grid-template-columns 0.3s ease, gap 0.3s ease;
    }

    .card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 22px;
      text-align: center;
      transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      border: 1px solid var(--card-border);
      backdrop-filter: blur(4px);
      opacity: 0;
    }

    .card.loaded {
      opacity: 1;
    }

    .card:hover {
      transform: translateY(-6px);
      box-shadow: 0 10px 25px var(--shadow);
      background: var(--accent-hover);
      border-color: var(--accent);
    }

    .card h2 {
      margin: 0 0 14px;
      color: var(--text-primary);
      font-size: 20px;
      font-weight: 600;
      transition: font-size 0.3s ease;
    }

    .card p {
      font-size: 14px;
      color: var(--text-secondary);
      margin: 0;
      line-height: 1.5;
      transition: font-size 0.3s ease;
    }

    a {
      text-decoration: none;
      color: inherit;
      display: block;
    }

    .pagination {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .pagination button {
      min-width: 36px;
      padding: 6px 10px;
      font-size: 14px;
    }

    .pagination .page-info {
      color: var(--text-secondary);
      font-size: 14px;
    }

    .loading {
      text-align: center;
      padding: 30px;
      color: var(--accent);
      font-size: 18px;
    }

    .spinner {
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid var(--accent);
      border-top: 2px solid transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-left: 8px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* –ú–µ–¥–∏–∞-–∑–∞–ø—Ä–æ—Å –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
    @media (max-width: 600px) {
      body:not(.force-pc) {
        padding: 12px;
      }
      h1 {
        font-size: 26px;
      }
      .search-box {
        max-width: 100%;
      }
      .controls {
        max-width: 100%;
      }
      .grid {
        grid-template-columns: 1fr;
        gap: 16px;
      }
      .card {
        padding: 18px;
      }
      .card h2 {
        font-size: 18px;
      }
      .card p {
        font-size: 13px;
      }
      #searchInput {
        padding: 10px 14px;
        font-size: 14px;
      }
    }

    /* –°–∏–º—É–ª—è—Ü–∏—è –º–æ–±–∏–ª—å–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ */
    body.mobile-view:not(.force-pc) {
      padding: 12px;
      max-width: 600px;
      margin: 0 auto;
    }
    body.mobile-view:not(.force-pc) h1 {
      font-size: 26px;
    }
    body.mobile-view:not(.force-pc) .search-box {
      max-width: 100%;
    }
    body.mobile-view:not(.force-pc) .controls {
      max-width: 100%;
    }
    body.mobile-view:not(.force-pc) .grid {
      grid-template-columns: 1fr;
      gap: 16px;
    }
    body.mobile-view:not(.force-pc) .card {
      padding: 18px;
    }
    body.mobile-view:not(.force-pc) .card h2 {
      font-size: 18px;
    }
    body.mobile-view:not(.force-pc) .card p {
      font-size: 13px;
    }
    body.mobile-view:not(.force-pc) #searchInput {
      padding: 10px 14px;
      font-size: 14px;
    }

    /* –ü–ö-—Ä–µ–∂–∏–º */
    body.force-pc {
      padding: 20px;
      max-width: none;
    }
    body.force-pc h1 {
      font-size: 32px;
    }
    body.force-pc .search-box {
      max-width: 600px;
    }
    body.force-pc .controls {
      max-width: 800px;
    }
    body.force-pc .grid {
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
    }
    body.force-pc .card {
      padding: 22px;
    }
    body.force-pc .card h2 {
      font-size: 20px;
    }
    body.force-pc .card p {
      font-size: 14px;
    }
    body.force-pc #searchInput {
      padding: 12px 16px;
      font-size: 16px;
    }

    @media (prefers-reduced-motion: reduce) {
      .card {
        transition: none;
      }
      .card:hover {
        transform: none;
        box-shadow: none;
      }
      body, h1, .search-box, .controls, .grid, .card, .card h2, .card p, #searchInput {
        transition: none;
      }
    }

    .note {
      text-align: center;
      color: var(--text-secondary);
      font-size: 13px;
      margin-top: 15px;
      max-width: 600px;
      margin: 15px auto;
    }
  </style>
</head>
<body>

  <h1>üéÆ –•—Ä–æ–Ω–æ–ª–æ–≥–∏–∏ –∏–≥—Ä–æ–≤—ã—Ö –≤—Å–µ–ª–µ–Ω–Ω—ã—Ö<br><small style="font-size:18px; color:#88ccdd;">by FobosNS</small></h1>

  <div class="search-box">
    <input type="text" id="searchInput" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏—é..." aria-label="–ü–æ–∏—Å–∫ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏–π">
  </div>

  <div class="controls">
    <div class="note" style="width: 100%; margin-bottom: 10px;">
      –ü–µ—Ä–µ–∫–ª—é—á–∞–π—Ç–µ —Ä–µ–∂–∏–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è, —Ç–µ–º—É –∏–ª–∏ –æ–±–Ω–æ–≤–ª—è–π—Ç–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –Ω–æ–≤—ã—Ö —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏–π
    </div>
    <div class="control-group">
      <button id="refresh-btn" aria-label="–û–±–Ω–æ–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ">üîÑ –û–±–Ω–æ–≤–∏—Ç—å</button>
      <button id="theme-toggle" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô</button>
      <button id="view-pc" class="active" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –ü–ö-—Ä–µ–∂–∏–º" aria-pressed="true">üñ•Ô∏è –ü–ö-—Ä–µ–∂–∏–º</button>
      <button id="view-mobile" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã–π —Ä–µ–∂–∏–º" aria-pressed="false">üì± –ú–æ–±–∏–ª—å–Ω—ã–π</button>
    </div>
    <div class="control-group">
      <button class="sort-btn active" data-sort="original" aria-label="–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∏—Å—Ö–æ–¥–Ω–æ–º—É –ø–æ—Ä—è–¥–∫—É">üîÉ –ò—Å—Ö–æ–¥–Ω—ã–π</button>
      <button class="sort-btn" data-sort="az" aria-label="–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É –ê-–Ø">üî§ –ê‚Üí–Ø</button>
      <button class="sort-btn" data-sort="za" aria-label="–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ –∞–ª—Ñ–∞–≤–∏—Ç—É –Ø-–ê">üî§ –Ø‚Üí–ê</button>
    </div>
  </div>

  <div class="loading" id="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏–π...</div>
  <div class="grid" id="gamesGrid" style="display:none;"></div>
  <div class="pagination" id="pagination" style="display:none;"></div>

  <div class="note">
    ¬© 2025 @FobosNS-POKROVSK FOREVER
  </div>

  <script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    let allGames = [];
    let filteredGames = [];
    let currentOrder = [];
    let currentPage = 1;
    const ITEMS_PER_PAGE = 8;

    const grid = document.getElementById('gamesGrid');
    const paginationEl = document.getElementById('pagination');
    const loadingEl = document.getElementById('loading');
    const searchInput = document.getElementById('searchInput');
    const viewPcBtn = document.getElementById('view-pc');
    const viewMobileBtn = document.getElementById('view-mobile');
    const themeToggleBtn = document.getElementById('theme-toggle');

    // –§—É–Ω–∫—Ü–∏—è —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ HTML
    function escapeHTML(str) {
      const div = document.createElement('div');
      div.textContent = str;
      return div.innerHTML;
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ games.json
    async function loadGames() {
      try {
        const response = await fetch(`games.json?v=${Date.now()}`);
        if (!response.ok) {
          throw new Error('games.json –Ω–µ –Ω–∞–π–¥–µ–Ω');
        }
        const games = await response.json();
        const validGames = games.filter(game => game.name && game.file);
        console.log('Loaded from server:', validGames);
        return validGames;
      } catch (e) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ games.json:", e);
        loadingEl.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–∑–∂–µ.';
        loadingEl.style.color = '#ff5555';
        return [];
      }
    }

    // –†–µ–Ω–¥–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    function renderPage() {
      const start = (currentPage - 1) * ITEMS_PER_PAGE;
      const pageGames = filteredGames.slice(start, start + ITEMS_PER_PAGE);

      grid.innerHTML = '';
      pageGames.forEach(game => {
        const card = document.createElement('a');
        card.href = `Resources-game/${game.file}`;
        card.classList.add('card');
        card.innerHTML = `
          <div>
            <h2>${escapeHTML((game.emoji || '') + ' ' + game.name)}</h2>
            <p>${escapeHTML(game.desc || '–ù–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è')}</p>
          </div>
        `;
        grid.appendChild(card);
      });

      const totalPages = Math.max(1, Math.ceil(filteredGames.length / ITEMS_PER_PAGE));
      paginationEl.style.display = totalPages > 1 ? 'flex' : 'none';
      if (totalPages > 1) {
        paginationEl.innerHTML = '';
        const firstBtn = document.createElement('button');
        firstBtn.textContent = '¬´';
        firstBtn.setAttribute('aria-label', '–ü–µ—Ä–≤–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞');
        firstBtn.disabled = currentPage === 1;
        firstBtn.addEventListener('click', () => changePage(-currentPage + 1));
        paginationEl.appendChild(firstBtn);

        const prevBtn = document.createElement('button');
        prevBtn.textContent = '‚ùÆ';
        prevBtn.setAttribute('aria-label', '–ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞');
        prevBtn.disabled = currentPage === 1;
        prevBtn.addEventListener('click', () => changePage(-1));
        paginationEl.appendChild(prevBtn);

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤ —Å—Ç—Ä–∞–Ω–∏—Ü
        const startPage = Math.max(1, currentPage - 2);
        const endPage = Math.min(totalPages, currentPage + 2);
        for (let i = startPage; i <= endPage; i++) {
          const pageBtn = document.createElement('button');
          pageBtn.textContent = i;
          pageBtn.setAttribute('aria-label', `–°—Ç—Ä–∞–Ω–∏—Ü–∞ ${i}`);
          pageBtn.classList.toggle('active', i === currentPage);
          pageBtn.disabled = i === currentPage;
          pageBtn.addEventListener('click', () => {
            currentPage = i;
            renderPage();
          });
          paginationEl.appendChild(pageBtn);
        }

        const pageInfo = document.createElement('div');
        pageInfo.className = 'page-info';
        pageInfo.textContent = `${currentPage} / ${totalPages}`;
        paginationEl.appendChild(pageInfo);

        const nextBtn = document.createElement('button');
        nextBtn.textContent = '‚ùØ';
        nextBtn.setAttribute('aria-label', '–°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞');
        nextBtn.disabled = currentPage === totalPages;
        nextBtn.addEventListener('click', () => changePage(1));
        paginationEl.appendChild(nextBtn);

        const lastBtn = document.createElement('button');
        lastBtn.textContent = '¬ª';
        lastBtn.setAttribute('aria-label', '–ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞');
        lastBtn.disabled = currentPage === totalPages;
        lastBtn.addEventListener('click', () => changePage(totalPages - currentPage));
        paginationEl.appendChild(lastBtn);
      }

      // –õ–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
      const observer = new IntersectionObserver((entries, observer) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('loaded');
            observer.unobserve(entry.target);
          }
        });
      }, { rootMargin: '100px' });

      document.querySelectorAll('.card:not(.loaded)').forEach(card => {
        observer.observe(card);
      });
    }

    // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.changePage = function(delta) {
      const totalPages = Math.max(1, Math.ceil(filteredGames.length / ITEMS_PER_PAGE));
      const newPage = currentPage + delta;
      if (newPage >= 1 && newPage <= totalPages) {
        currentPage = newPage;
        renderPage();
      }
    };

    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏
    function applyFilters() {
      const query = searchInput.value.toLowerCase();
      filteredGames = currentOrder.filter(game =>
        game.name.toLowerCase().includes(query) ||
        (game.desc || '').toLowerCase().includes(query)
      );
      currentPage = 1;
      renderPage();
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    async function init() {
      loadingEl.innerHTML = '–ó–∞–≥—Ä—É–∑–∫–∞ —Ö—Ä–æ–Ω–æ–ª–æ–≥–∏–π... <span class="spinner"></span>';
      loadingEl.style.color = 'var(--accent)';
      allGames = await loadGames();
      currentOrder = [...allGames];
      filteredGames = [...allGames];

      const savedMode = localStorage.getItem('viewMode');
      if (savedMode === 'mobile') {
        viewMobileBtn.click();
      }
      const savedSort = localStorage.getItem('sortMode');
      if (savedSort) {
        document.querySelector(`.sort-btn[data-sort="${savedSort}"]`).click();
      }
      const savedTheme = localStorage.getItem('theme');
      if (savedTheme === 'light') {
        document.body.classList.add('light-theme');
        themeToggleBtn.textContent = 'üåû';
      }

      loadingEl.style.display = 'none';
      grid.style.display = 'grid';
      renderPage();
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    let timeout;
    searchInput.addEventListener('input', () => {
      clearTimeout(timeout);
      timeout = setTimeout(applyFilters, 300);
    });

    document.querySelectorAll('.sort-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.sort-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        const mode = btn.dataset.sort;
        if (mode === 'az') {
          currentOrder = [...allGames].sort((a, b) => a.name.localeCompare(b.name, 'ru'));
        } else if (mode === 'za') {
          currentOrder = [...allGames].sort((a, b) => b.name.localeCompare(a.name, 'ru'));
        } else {
          currentOrder = [...allGames];
        }
        localStorage.setItem('sortMode', mode);
        applyFilters();
      });
    });

    viewPcBtn.addEventListener('click', () => {
      document.body.classList.remove('mobile-view');
      document.body.classList.add('force-pc');
      viewPcBtn.classList.add('active');
      viewMobileBtn.classList.remove('active');
      viewPcBtn.setAttribute('aria-pressed', 'true');
      viewMobileBtn.setAttribute('aria-pressed', 'false');
      localStorage.setItem('viewMode', 'pc');
    });

    viewMobileBtn.addEventListener('click', () => {
      document.body.classList.add('mobile-view');
      document.body.classList.remove('force-pc');
      viewMobileBtn.classList.add('active');
      viewPcBtn.classList.remove('active');
      viewMobileBtn.setAttribute('aria-pressed', 'true');
      viewPcBtn.setAttribute('aria-pressed', 'false');
      localStorage.setItem('viewMode', 'mobile');
    });

    themeToggleBtn.addEventListener('click', () => {
      document.body.classList.toggle('light-theme');
      const isLight = document.body.classList.contains('light-theme');
      themeToggleBtn.textContent = isLight ? 'üåû' : 'üåô';
      localStorage.setItem('theme', isLight ? 'light' : 'dark');
    });

    document.getElementById('refresh-btn').addEventListener('click', () => {
      searchInput.value = '';
      document.querySelector('.sort-btn[data-sort="original"]').click();
      const refreshBtn = document.getElementById('refresh-btn');
      refreshBtn.innerHTML = 'üîÑ –û–±–Ω–æ–≤–∏—Ç—å <span class="spinner"></span>';
      refreshBtn.disabled = true;
      init().finally(() => {
        refreshBtn.innerHTML = 'üîÑ –û–±–Ω–æ–≤–∏—Ç—å';
        refreshBtn.disabled = false;
      });
    });

    // –ó–∞–ø—É—Å–∫
    init();
  </script>
</body>
</html>
